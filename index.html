<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NTPUé›²ç«¯æ„Ÿè¬å¡2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* --- 1. æ ¸å¿ƒè®Šæ•¸å®šç¾© (ç§‘æŠ€éœ“è™¹é…è‰²) --- */
        :root {
            --bg-dark: #0a0a12; /* æ·±é‚ƒå¤ªç©ºé»‘ */
            --panel-bg: rgba(16, 24, 48, 0.8); /* åŠé€æ˜é¢æ¿ */
            --neon-cyan: #00f3ff; /* é’è‰²éœ“è™¹ */
            --neon-blue: #0066ff; /* è—è‰²éœ“è™¹ */
            --neon-pink: #ff00ff; /* ç²‰è‰²éœ“è™¹ */
            --text-glow: 0 0 10px rgba(0, 243, 255, 0.5); /* æ–‡å­—ç™¼å…‰ */
            --border-glow: 0 0 15px rgba(0, 102, 255, 0.6); /* é‚Šæ¡†ç™¼å…‰ */
        }

        /* --- 2. å…¨å±€æ¨£å¼èˆ‡èƒŒæ™¯ --- */
        body {
            margin: 0; padding: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-dark);
            /* ç§‘æŠ€æ„ŸèƒŒæ™¯ç´‹ç† (ç¶²æ ¼ + æƒæç·š) */
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                radial-gradient(circle at 50% 50%, rgba(0, 102, 255, 0.15), transparent 70%);
            background-size: 30px 30px, 30px 30px, 100% 100%;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- 3. æ¨™é¡Œå€ (Header) --- */
        header {
            text-align: center; padding: 60px 20px 40px;
            position: relative;
            border-bottom: 2px solid var(--neon-blue);
            box-shadow: 0 5px 20px rgba(0, 102, 255, 0.3);
        }
        /* æ¨™é¡Œä¸‹æ–¹çš„æƒæå…‰æ¢å‹•ç•« */
        header::after {
            content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
            animation: scanline 3s linear infinite;
        }
        header h1 {
            margin: 0; font-family: 'Orbitron', sans-serif; font-size: 2.5rem;
            text-transform: uppercase; letter-spacing: 4px;
            color: var(--neon-cyan); text-shadow: var(--text-glow);
            /* æ–°å¢ï¼šè®“ Logo èˆ‡æ–‡å­—å‚ç›´ç½®ä¸­å°é½Š */
            display: flex; align-items: center; justify-content: center;
        }
        /* æ–°å¢ï¼šLogo æ¨£å¼ */
        .header-logo {
            height: 1.2em; /* é«˜åº¦è·Ÿè‘—æ–‡å­—å¤§å°è·‘ */
            width: auto;
            margin-right: 15px; /* èˆ‡å³é‚Šæ–‡å­—çš„è·é›¢ */
            vertical-align: middle;
        }

        header p { opacity: 0.8; margin-top: 15px; font-size: 1.1rem; color: #aabbee; }

        /* --- 4. ä¸»è¦å…§å®¹å€ (2x2 Grid ä½ˆå±€) --- */
        .main-grid {
            max-width: 1400px; margin: 40px auto; padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* å…©æ¬„ */
            gap: 30px; /* é–“è· */
        }

        /* æ¯ä¸€çµ„çš„å®¹å™¨é¢æ¿ */
        .group-panel {
            background: var(--panel-bg);
            border: 1px solid var(--neon-blue);
            border-radius: 12px; overflow: hidden;
            box-shadow: var(--border-glow), inset 0 0 20px rgba(0, 102, 255, 0.2);
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .group-panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.5), inset 0 0 30px rgba(0, 243, 255, 0.3);
            border-color: var(--neon-cyan);
        }
        
        /* çµ„åˆ¥æ¨™é¡Œ */
        .group-title {
            padding: 15px; text-align: center; font-family: 'Orbitron', sans-serif;
            background: rgba(0, 102, 255, 0.2); color: var(--neon-cyan);
            border-bottom: 1px solid var(--neon-blue);
        }

        /* ç…§ç‰‡å®¹å™¨ (è™•ç† Google Drive åœ–ç‰‡å¤§å°çš„é—œéµ) */
        .photo-container {
            position: relative; width: 100%;
            /* è¨­å®šä¸€å€‹å›ºå®šçš„å¯¬é«˜æ¯”ï¼Œä¾‹å¦‚ 4:3ï¼Œç¢ºä¿æ’ç‰ˆæ•´é½Š */
            aspect-ratio: 4 / 3; 
            background: #000; overflow: hidden;
        }
        /* Google Drive åœ–ç‰‡æ¨£å¼ */
        .group-photo {
            width: 100%; height: 100%; 
            object-fit: cover; /* é—œéµï¼šå¡«æ»¿å®¹å™¨ä¸”ä¸è®Šå½¢ */
            opacity: 0.9; transition: all 0.5s;
            filter: contrast(1.1) saturate(1.1); /* å¢åŠ ä¸€é»ç§‘æŠ€æ„Ÿæ¿¾é¡ */
        }
        .group-panel:hover .group-photo { opacity: 1; transform: scale(1.05); }
        /* ç…§ç‰‡ä¸Šçš„æƒæç·šè¦†è“‹å±¤ */
        .photo-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(transparent 0px, transparent 2px, rgba(0, 243, 255, 0.1) 3px);
            pointer-events: none; /* ä¸æ“‹ä½é»æ“Š */
        }


        /* --- 5. äº’å‹•æ¨™ç±¤ (Tag) - é«˜å°æ¯”åº¦å„ªåŒ–ç‰ˆ (å­—é«”æ”¾å¤§ç‰ˆ) --- */
        .name-tag {
            position: absolute; transform: translate(-50%, -50%);
            /* ä¿®æ”¹ï¼šç¨å¾®åŠ å¤§å…§è· */
            padding: 6px 14px;
            /* ä¿®æ”¹ï¼šåŠ å¤§å­—é«” (åŸæœ¬ 12px -> 15px) */
            font-size: 15px;
            font-weight: 700; font-family: 'Orbitron', sans-serif;
            cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            white-space: nowrap;
            /* ç§‘æŠ€æ„Ÿåˆ‡å‰² */
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
            /* åŠ å…¥æ–‡å­—é»‘è‰²é™°å½±ï¼Œç¢ºä¿åœ¨äº®è™•ä¹Ÿçœ‹å¾—è¦‹ */
            text-shadow: 0 0 3px rgba(0,0,0,1);
            z-index: 5;
        }

        /* ç‹€æ…‹ï¼šæœªå¯« (æ·±åº•é’å­—ï¼Œå¼·çƒˆé–ƒçˆ) */
        .tag-empty {
            /* æ·±è‰²èƒŒæ™¯ï¼Œç¢ºä¿æ–‡å­—æ¸…æ™° */
            background: rgba(2, 12, 26, 0.9); 
            color: var(--neon-cyan);
            /* åŠ ç²—é‚Šæ¡† */
            border: 1px solid var(--neon-cyan);
            /* åŸºç¤ç™¼å…‰ */
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.4), inset 0 0 5px rgba(0, 243, 255, 0.2);
            animation: pulseTag 2s infinite alternate;
        }
        .tag-empty:hover { 
            background: var(--neon-cyan); 
            color: #000; /* èƒŒæ™¯äº®æ™‚æ–‡å­—è®Šé»‘ */
            text-shadow: none;
            box-shadow: 0 0 20px var(--neon-cyan); 
            transform: translate(-50%, -60%) scale(1.1);
            z-index: 15; 
        }

        /* ç‹€æ…‹ï¼šå·²å¯« (æ·±åº•ç²‰å­—ï¼Œæ†äº®ç™¼å…‰) */
        .tag-filled {
            background: rgba(26, 2, 20, 0.9); 
            color: var(--neon-pink);
            border: 1px solid var(--neon-pink);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5), inset 0 0 5px rgba(255, 0, 255, 0.3);
        }
        .tag-filled::before { content: 'â—ˆ '; color: var(--neon-pink); }
        .tag-filled:hover { 
            background: var(--neon-pink); 
            color: #fff; 
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            transform: translate(-50%, -60%) scale(1.15); 
            z-index: 15; 
            box-shadow: 0 0 30px var(--neon-pink); 
        }


        /* --- 6. Modal è¦–çª— (ç§‘æŠ€é¢æ¿é¢¨æ ¼) --- */
        .modal {
            display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0, 10, 20, 0.9); /* æ·±è‰²èƒŒæ™¯ */
            backdrop-filter: blur(8px); /* å¼·åŠ›æ¨¡ç³Š */
            align-items: center; justify-content: center;
        }
        .modal.show { display: flex; animation: holoPop 0.4s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        .modal-content {
            background: linear-gradient(135deg, rgba(16, 24, 48, 0.95), rgba(0, 0, 0, 0.95));
            width: 90%; max-width: 600px;
            border: 2px solid var(--neon-blue); border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 102, 255, 0.4), inset 0 0 20px rgba(0, 102, 255, 0.2);
            position: relative; max-height: 90vh; display: flex; flex-direction: column;
            overflow: hidden;
        }
        /* Modal é ‚éƒ¨çš„è£é£¾æ¢ */
        .modal-header-bar { height: 5px; background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink)); width: 100%; }

        .close-btn {
            position: absolute; top: 15px; right: 20px; font-size: 30px; color: var(--neon-blue);
            cursor: pointer; z-index: 10; transition: 0.3s; text-shadow: 0 0 5px var(--neon-blue);
        }
        .close-btn:hover { color: var(--neon-cyan); transform: rotate(90deg); }

        /* View Modal UI */
        .view-img-wrap { width: 100%; height: 350px; background: rgba(0,0,0,0.5); flex-shrink: 0; border-bottom: 1px solid var(--neon-blue); }
        .view-img-wrap img { width: 100%; height: 100%; object-fit: contain; }
        .view-info { padding: 30px; overflow-y: auto; color: #aabbee; }
        .view-msg { font-size: 1.15rem; line-height: 1.8; white-space: pre-wrap; font-style: italic; text-shadow: 0 0 2px rgba(0, 102, 255, 0.5); }
        .view-author { text-align: right; color: var(--neon-cyan); font-family: 'Orbitron', sans-serif; margin-top: 20px; font-size: 1.2rem; }

        /* Write Modal UI (è¡¨å–®) */
        .form-body { padding: 40px; overflow-y: auto; color: #fff; }
        .form-title { text-align: center; color: var(--neon-cyan); margin-top: 0; font-family: 'Orbitron', sans-serif; text-transform: uppercase; }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 10px; color: var(--neon-blue); font-family: 'Orbitron', sans-serif; font-size: 0.9rem; }
        /* ç§‘æŠ€æ„Ÿè¼¸å…¥æ¡† */
        input, textarea {
            width: 100%; padding: 15px;
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid var(--neon-blue); border-radius: 5px;
            color: var(--neon-cyan); font-family: 'Noto Sans TC', sans-serif;
            box-sizing: border-box; transition: 0.3s;
        }
        input:focus, textarea:focus {
            outline: none; border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
            background: rgba(0, 30, 60, 0.9);
        }
        /* ç§‘æŠ€æ„ŸæŒ‰éˆ• */
        .btn-submit {
            width: 100%; padding: 15px;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-cyan));
            color: #000; border: none; border-radius: 5px;
            cursor: pointer; font-size: 1.1rem; font-weight: bold; font-family: 'Orbitron', sans-serif;
            text-transform: uppercase; letter-spacing: 2px;
            transition: 0.3s; position: relative; overflow: hidden;
        }
        .btn-submit:hover {
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.6); color: #fff;
        }
        .btn-submit:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none;}


        /* --- 7. å‹•ç•«å®šç¾© --- */
        @keyframes scanline { 0% { left: -100%; } 100% { left: 100%; } }
        
        /* æ–°å¢ï¼šæ›´å¼·çƒˆçš„å‘¼å¸ç‡ˆå‹•ç•« */
        @keyframes pulseTag {
            0% {
                box-shadow: 0 0 10px rgba(0, 243, 255, 0.4), inset 0 0 5px rgba(0, 243, 255, 0.2);
                border-color: rgba(0, 243, 255, 0.6);
            }
            100% {
                box-shadow: 0 0 20px rgba(0, 243, 255, 0.8), inset 0 0 10px rgba(0, 243, 255, 0.4);
                border-color: var(--neon-cyan);
            }
        }
        
        @keyframes holoPop { 0% { opacity: 0; transform: scale(0.8) translateY(20px); filter: blur(10px); } 100% { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); } }

        /* --- 8. RWD éŸ¿æ‡‰å¼ (æ‰‹æ©Ÿç‰ˆè®Šå–®æ¬„) --- */
        @media (max-width: 768px) {
            header h1 { font-size: 1.8rem; }
            .main-grid { grid-template-columns: 1fr; gap: 40px; } /* æ‰‹æ©Ÿç‰ˆè®Šä¸€æ¬„å‚ç›´æ’åˆ— */
            .view-img-wrap { height: 250px; }
            .group-panel { margin-bottom: 20px; }
        }
    </style>
</head>
<body>

<header>
    <h1>
        NTPUé‡‘èå‰µæ–°AIå°ˆç­2025
    </h1>
    <p>æ„Ÿè¬å®‹åšå£«çš„å°ˆæ¥­æŒ‡å¼•èˆ‡æ¸¸ç¶“ç†çš„æ‚‰å¿ƒæ•™å°ï¼Œé€™é¢ç‰†é›†çµäº†å¤§å®¶çš„ç¥ç¦!</p>
</header>

<div class="main-grid" id="mainStage">
    <div style="grid-column: 1 / -1; text-align:center; padding:50px; color:var(--neon-cyan); font-family:'Orbitron'">
        [SYSTEM] Initializing Data Stream...
    </div>
</div>


<div id="writeModal" class="modal">
    <div class="modal-content form-body">
        <div class="modal-header-bar"></div>
        <span class="close-btn" onclick="closeModal('writeModal')">+</span>
        <h2 class="form-title">// UPLOAD MESSAGE //</h2>
        <p style="text-align:center; color:#aabbee; margin-bottom:30px;">
            Target ID: <span id="writeNameDisplay" style="color:var(--neon-pink); font-weight:bold; font-family:'Orbitron'"></span>
        </p>
        <input type="hidden" id="inputName">
        
        <div class="form-group">
            <label>[ä¸Šå‚³åœ–ç‰‡ (é¸å¡«)]</label>
            <input type="file" id="inputFile" accept="image/*" style="padding: 10px; background: rgba(0,243,255,0.1);">
        </div>
        <div class="form-group">
            <label>[DATA TYPE: TEXT]</label>
            <textarea id="inputMsg" rows="5" placeholder="Enter your transmission here..."></textarea>
        </div>
        <button class="btn-submit" id="btnSubmit" onclick="submitData()">TRANSMIT DATA</button>
        <p id="statusMsg" style="text-align:center; color:var(--neon-cyan); margin-top:15px; font-family:'Orbitron'"></p>
    </div>
</div>

<div id="viewModal" class="modal">
    <div class="modal-content">
        <div class="modal-header-bar"></div>
        <span class="close-btn" onclick="closeModal('viewModal')">+</span>
        <div class="view-img-wrap">
            <img id="viewImg" src="">
        </div>
        <div class="view-info">
            <div id="viewMsg" class="view-msg"></div>
            <div id="viewAuthor" class="view-author"></div>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // âš™ï¸ SYSTEM CONFIGURATION (æ ¸å¿ƒè¨­å®šå€)
    // ==========================================
    
    // 1. Google Apps Script ç¶²å€
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpntGmGZ2Xk3imhL7wMrSSAXDSIEKDHQINgvVihpNYOj8ZhXAScrudfc3Y6X5dCnl4/exec"; 

    // 2. é è¨­çš„ã€Œæ„Ÿè¬åœ–ã€ç¶²å€ (ç•¶æ²’ä¸Šå‚³åœ–ç‰‡æ™‚é¡¯ç¤ºé€™å¼µ)
    // é€™æ˜¯ä¸€å¼µéœ“è™¹ç‡ˆé¢¨æ ¼çš„ "Thank You" åœ–ç‰‡ï¼Œéå¸¸ç¬¦åˆä½ çš„ç¶²é é¢¨æ ¼
    const DEFAULT_THANK_YOU_IMG = "https://drive.google.com/thumbnail?id=1DwqTr8P4u1EhnrBJhOEEVhxYn7Se00AO&sz=w1000";

    // 3. å››çµ„è³‡æ–™è¨­å®š
    const GROUPS_CONFIG = [
        {
            id: "group1", title: "å¿«æ¨‚é›²ç«¯å¥½å¤¥ä¼´ä¸€",
            photoUrl: "https://drive.google.com/thumbnail?id=1iCOrs_4WHAd1RseBSEfSNi0ORJ9TQYDH&sz=w1000", 
            students: [
                { name: "æ½˜é›ªç”„", x: 15, y: 41.80 },
                { name: "è”¡å ¡ä¸", x: 26, y: 80 },
                { name: "è¬å®›éŒ¡", x: 40.30, y: 27 },
                { name: "æ±ŸèŠ¸å¸†", x: 60.60, y: 80 },
                { name: "é»ƒè–å‰›", x: 73.60, y: 30.47 },
            ]
        },
        {
            id: "group2", title: "å¿«æ¨‚é›²ç«¯å¥½å¤¥ä¼´äºŒ",
            photoUrl: "https://drive.google.com/thumbnail?id=1oaKhjuXl4vV4pnmnUO_gwbksTuCjjLjq&sz=w1000",
            students: [
                { name: "åŠ‰å­¸æ—»", x: 11.05, y: 26.5 },
                { name: "é„§å‹‡æ–Œ", x: 33.80, y: 17 },
                { name: "é»ƒå“æ–‡", x: 55, y: 80 },
                { name: "ç‹äºå©•", x: 65, y: 25.80 },
                { name: "æ´ªå®œé–", x: 85, y: 35 },
            ] 
        },
        {
            id: "group3", title: "å¿«æ¨‚é›²ç«¯å¥½å¤¥ä¼´ä¸‰",
            photoUrl: "https://drive.google.com/thumbnail?id=10ZbIo4qeANzCb3EasagoR7A9iRa0D36g&sz=w1000", 
            students: [
                { name: "æå…‰ç¿”", x: 16.60, y: 12.34 },
                { name: "é™³ç’Ÿè±", x: 50, y: 15 },
                { name: "æ®·å¯ç›ˆ", x: 62, y: 80 },
                { name: "é™³é€¸è»’", x: 78.10, y: 10 },
            ]
        },
        {
            id: "group4", title: "å¿«æ¨‚é›²ç«¯å¥½å¤¥ä¼´å››",
            photoUrl: "https://drive.google.com/thumbnail?id=1ZryLVT7QBdKPD4Gtdd-r7wT_kzB1Br-M&sz=w1000",
            students: [
                { name: "é«˜ä½³ç…’", x: 15 , y: 26.60 },
                { name: "è¬ç¦®é›‹", x: 28, y: 80 },
                { name: "ææ—»å„’", x: 44, y: 16.87 },
                { name: "èƒ¡å–¬é’å¿ƒ", x: 68.20, y: 80 },
                { name: "é™³çªé›¯", x: 82.70, y: 22.20 },
            ]
        }
    ];


    // ==========================================
    // ğŸš€ SYSTEM CORE LOGIC
    // ==========================================
    let serverData = []; 

    window.onload = function() {
        initMainGrid(); 
        
        if (SCRIPT_URL) {
            fetch(SCRIPT_URL)
                .then(res => res.json())
                .then(data => {
                    serverData = data;
                    refreshAllTags(); 
                })
                .catch(err => {
                    console.error("Data Stream Error:", err);
                    document.getElementById('mainStage').innerHTML = '<div style="color:red;text-align:center;">[ERROR] Connection Failed.</div>';
                });
        } else {
            console.log("[MODE] Preview Mode Active");
            serverData = [{ name: "ç¯„ä¾‹åŒå­¸A", message: "System check: All systems nominal.", imageUrl: "https://via.placeholder.com/400x300/00f3ff/000000?text=DATA+IMAGE" }];
            setTimeout(refreshAllTags, 1000);
        }
    };

    // åˆå§‹åŒ–ï¼šå»ºç«‹å››å€‹çµ„åˆ¥çš„é¢æ¿
    function initMainGrid() {
        const stage = document.getElementById('mainStage');
        stage.innerHTML = ''; 

        GROUPS_CONFIG.forEach(config => {
            const panel = document.createElement('div');
            panel.className = 'group-panel';
            
            const title = document.createElement('div');
            title.className = 'group-title';
            title.innerText = config.title;
            panel.appendChild(title);

            const photoContainer = document.createElement('div');
            photoContainer.className = 'photo-container';
            
            const img = document.createElement('img');
            img.src = config.photoUrl || 'https://via.placeholder.com/800x600/0a0a12/00f3ff?text=IMAGE+NOT+FOUND'; 
            img.className = 'group-photo';
            photoContainer.appendChild(img);
            
            const overlay = document.createElement('div');
            overlay.className = 'photo-overlay';
            photoContainer.appendChild(overlay);

            config.students.forEach(student => {
                const tag = document.createElement('div');
                tag.className = 'name-tag tag-empty'; 
                tag.style.left = student.x + '%';
                tag.style.top = student.y + '%';
                tag.innerText = student.name;
                tag.dataset.name = student.name; 
                tag.onclick = () => openWriteModal(student.name);
                photoContainer.appendChild(tag);
            });

            panel.appendChild(photoContainer);
            stage.appendChild(panel);
        });
    }

    // æ›´æ–°æ‰€æœ‰æ¨™ç±¤ç‹€æ…‹
    function refreshAllTags() {
        const allTags = document.querySelectorAll('.name-tag');
        allTags.forEach(tag => {
            const name = tag.dataset.name;
            const userData = serverData.find(d => d.name === name);

            if (userData) {
                tag.className = 'name-tag tag-filled'; // å·²å¯«ç‹€æ…‹
                tag.onclick = () => openViewModal(userData);
            } else {
                tag.className = 'name-tag tag-empty'; // æœªå¯«ç‹€æ…‹
                tag.onclick = () => openWriteModal(name);
            }
        });
    }

    // ==========================================
    // ğŸ–¥ï¸ INTERFACE CONTROL (Modals)
    // ==========================================
    window.openWriteModal = function(name) {
        document.getElementById('writeModal').classList.add('show');
        document.getElementById('writeNameDisplay').innerText = name;
        document.getElementById('inputName').value = name;
        document.getElementById('statusMsg').innerText = '';
        document.getElementById('btnSubmit').disabled = false;
        document.getElementById('btnSubmit').innerText = 'TRANSMIT DATA';
        document.getElementById('inputFile').value = ""; 
    };

    window.submitData = function() {
        const name = document.getElementById('inputName').value;
        const msg = document.getElementById('inputMsg').value;
        const fileInput = document.getElementById('inputFile');
        const file = fileInput.files[0];
        const btn = document.getElementById('btnSubmit');
        const status = document.getElementById('statusMsg');

        if (!name || !msg) { 
            alert("[ERROR] è«‹è‡³å°‘å¡«å¯«åå­—å’Œç¥ç¦å…§å®¹ï¼"); 
            return; 
        }

        btn.disabled = true;
        btn.innerText = "PROCESSING...";
        status.innerText = "[STATUS] Uploading data...";

        const sendPayload = (imgData) => {
            const payload = { name: name, message: msg, image: imgData };
            
            if (SCRIPT_URL) {
                fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
                    .then(() => { alert("[SUCCESS] Data transmission complete."); location.reload(); })
                    .catch(() => { alert("[SUCCESS] Data transmission complete."); location.reload(); });
            } else {
                alert("[MODE] Preview mode. Data logged.");
                console.log(payload);
                btn.disabled = false; btn.innerText = "TRANSMIT DATA"; status.innerText = "";
            }
        };

        if (file) {
            const maxWidth = 1000;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width; let height = img.height;
                    if (width > maxWidth) { height *= maxWidth / width; width = maxWidth; }
                    canvas.width = width; canvas.height = height;
                    canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
                    
                    status.innerText = "[STATUS] Transmitting payload...";
                    sendPayload(dataUrl);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        } else {
            status.innerText = "[STATUS] Transmitting text-only payload...";
            sendPayload("");
        }
    };

    window.openViewModal = function(data) {
        document.getElementById('viewModal').classList.add('show');
        // ğŸš€ ä¿®æ”¹é€™è£¡ï¼šå¦‚æœ imageUrl ç‚ºç©ºï¼Œå°±ä½¿ç”¨é è¨­æ„Ÿè¬åœ– (DEFAULT_THANK_YOU_IMG)
        document.getElementById('viewImg').src = data.imageUrl || DEFAULT_THANK_YOU_IMG;
        document.getElementById('viewMsg').innerText = data.message;
        document.getElementById('viewAuthor').innerText = "// DATA SOURCE: " + data.name;
    };

    window.closeModal = function(id) {
        document.getElementById(id).classList.remove('show');
    };
    
    window.onclick = function(e) {
        if (e.target.classList.contains('modal')) e.target.classList.remove('show');
    };
</script>

</body>
</html>
